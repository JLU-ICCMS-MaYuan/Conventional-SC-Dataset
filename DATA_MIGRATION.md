# æ•°æ®è¿ç§»æŒ‡å—

## ðŸ“‹ æ¦‚è¿°

å½“ä½ åœ¨æœ¬åœ°å¼€å‘çŽ¯å¢ƒä¸Šä¼ äº†æ–‡çŒ®æ•°æ®åŽï¼Œéƒ¨ç½²åˆ°ç”Ÿäº§çŽ¯å¢ƒæ—¶éœ€è¦è¿ç§»è¿™äº›æ•°æ®ã€‚æœ¬æŒ‡å—æä¾›äº†ä¸‰ç§æ•°æ®è¿ç§»æ–¹æ¡ˆã€‚

---

## ðŸŽ¯ æ–¹æ¡ˆä¸€ï¼šç›´æŽ¥å¤åˆ¶æ•°æ®åº“æ–‡ä»¶ï¼ˆæœ€ç®€å•ï¼‰

**é€‚ç”¨åœºæ™¯ï¼š** VPSéƒ¨ç½²ï¼Œæ•°æ®é‡ä¸å¤§

### æ­¥éª¤ï¼š

**1. å¤‡ä»½æœ¬åœ°æ•°æ®åº“**
```bash
cp data/superconductor.db data/superconductor_backup_$(date +%Y%m%d).db
```

**2. ä¸Šä¼ åˆ°æœåŠ¡å™¨**

ä½¿ç”¨ scp ä¸Šä¼ ï¼ˆå‡è®¾æœåŠ¡å™¨IPæ˜¯ `123.45.67.89`ï¼‰ï¼š
```bash
scp data/superconductor.db root@123.45.67.89:/var/www/conventional-sc-dataset/data/
```

**3. é‡å¯æœåŠ¡**
```bash
ssh root@123.45.67.89
systemctl restart superconductor
```

---

## ðŸŽ¯ æ–¹æ¡ˆäºŒï¼šå¯¼å‡ºå¯¼å…¥JSONï¼ˆæŽ¨èï¼‰

**é€‚ç”¨åœºæ™¯ï¼š** æ‰€æœ‰éƒ¨ç½²æ–¹å¼ï¼Œæ•°æ®å®‰å…¨å¯é 

### ä¼˜ç‚¹ï¼š
- âœ… è·¨å¹³å°å…¼å®¹ï¼ˆWindows â†’ Linuxï¼‰
- âœ… å¯è¯»æ€§å¼ºï¼Œå¯æ‰‹åŠ¨ç¼–è¾‘
- âœ… ç‰ˆæœ¬æŽ§åˆ¶å‹å¥½
- âœ… æ”¯æŒé€‰æ‹©æ€§å¯¼å…¥

### å¯¼å‡ºæ•°æ®

**1. åœ¨æœ¬åœ°çŽ¯å¢ƒè¿è¡Œå¯¼å‡ºè„šæœ¬ï¼š**
```bash
python -m backend.export_data
```

**2. è¾“å‡ºæ–‡ä»¶ï¼š**
- ä½ç½®ï¼š`data/data_export.json`
- åŒ…å«æ‰€æœ‰æ–‡çŒ®ã€æˆªå›¾ã€å…ƒç´ ç»„åˆæ•°æ®

**3. æŸ¥çœ‹å¯¼å‡ºä¿¡æ¯ï¼š**
```
âœ… å¯¼å‡ºå®Œæˆï¼
   æ–‡ä»¶ä½ç½®: /path/to/data/data_export.json
   å…ƒç´ : 118 ä¸ª
   å…ƒç´ ç»„åˆ: 15 ä¸ª
   æ–‡çŒ®: 42 ç¯‡
   æˆªå›¾: 156 å¼ 
   æ–‡ä»¶å¤§å°: 23.45 MB
```

### å¯¼å…¥æ•°æ®

**1. ä¸Šä¼ JSONæ–‡ä»¶åˆ°æœåŠ¡å™¨**

é€šè¿‡ scpï¼š
```bash
scp data/data_export.json root@123.45.67.89:/var/www/conventional-sc-dataset/data/
```

æˆ–è€…é€šè¿‡ Railway CLIï¼š
```bash
railway run scp data/data_export.json /app/data/
```

**2. åœ¨æœåŠ¡å™¨ä¸Šè¿è¡Œå¯¼å…¥è„šæœ¬ï¼š**

æ™®é€šå¯¼å…¥ï¼ˆä¿ç•™çŽ°æœ‰æ•°æ®ï¼Œè·³è¿‡é‡å¤ï¼‰ï¼š
```bash
python -m backend.import_data
```

æ¸…ç©ºçŽ°æœ‰æ•°æ®åŽå¯¼å…¥ï¼ˆâš ï¸ è°¨æ…Žä½¿ç”¨ï¼‰ï¼š
```bash
python -m backend.import_data --clear
```

**3. éªŒè¯å¯¼å…¥ç»“æžœï¼š**
```
âœ… å¯¼å…¥å®Œæˆï¼
   å…ƒç´ ç»„åˆ: 15 ä¸ª
   æ–‡çŒ®: 42 ç¯‡
   æˆªå›¾: 156 å¼ 
```

---

## ðŸŽ¯ æ–¹æ¡ˆä¸‰ï¼šæŒä¹…åŒ–å­˜å‚¨ï¼ˆè‡ªåŠ¨åŒæ­¥ï¼‰

**é€‚ç”¨åœºæ™¯ï¼š** Railway/Renderéƒ¨ç½²ï¼Œé•¿æœŸè¿è¥

### Railway é…ç½®æŒä¹…åŒ–å­˜å‚¨

**1. åœ¨ Railway é¡¹ç›®ä¸­æ·»åŠ  Volume**
- æ‰“å¼€ Railway é¡¹ç›®
- ç‚¹å‡»æœåŠ¡ â†’ "Variables" â†’ "Add Volume"
- æŒ‚è½½è·¯å¾„ï¼š`/app/data`
- å¤§å°ï¼šé€‰æ‹©åˆé€‚çš„å¤§å°ï¼ˆå¦‚ 1GBï¼‰

**2. ä¸Šä¼ æ•°æ®åº“æ–‡ä»¶**

ä½¿ç”¨ Railway CLIï¼š
```bash
# å®‰è£… CLI
npm install -g @railway/cli

# ç™»å½•
railway login

# è¿žæŽ¥é¡¹ç›®
railway link

# ä¸Šä¼ æ•°æ®åº“
railway run bash -c "cat > /app/data/superconductor.db" < data/superconductor.db
```

æˆ–è€…ä½¿ç”¨å¯¼å‡ºå¯¼å…¥æ–¹æ¡ˆï¼š
```bash
# ä¸Šä¼ JSON
railway run bash -c "cat > /app/data/data_export.json" < data/data_export.json

# æ‰§è¡Œå¯¼å…¥
railway run python -m backend.import_data
```

### Render é…ç½®æŒä¹…åŒ–ç£ç›˜

**1. åœ¨ Render é¡¹ç›®ä¸­æ·»åŠ  Disk**
- æ‰“å¼€ Render é¡¹ç›®è®¾ç½®
- æ‰¾åˆ° "Disk" é€‰é¡¹
- æ·»åŠ æ–°ç£ç›˜
  - åç§°ï¼š`data`
  - æŒ‚è½½è·¯å¾„ï¼š`/opt/render/project/src/data`
  - å¤§å°ï¼š1GBï¼ˆå…è´¹ï¼‰

**2. éƒ¨ç½²åŽï¼Œä½¿ç”¨å¯¼å‡ºå¯¼å…¥æ–¹æ¡ˆè¿ç§»æ•°æ®**

---

## ðŸ“Š å„æ–¹æ¡ˆå¯¹æ¯”

| æ–¹æ¡ˆ | éš¾åº¦ | é€Ÿåº¦ | å¯é æ€§ | é€‚ç”¨åœºæ™¯ |
|------|------|------|--------|----------|
| ç›´æŽ¥å¤åˆ¶DBæ–‡ä»¶ | â­ æžç®€ | â­â­â­ å¿« | â­â­ ä¸­ | VPSéƒ¨ç½² |
| å¯¼å‡ºå¯¼å…¥JSON | â­â­ ç®€å• | â­â­ ä¸­ | â­â­â­ é«˜ | æ‰€æœ‰åœºæ™¯ |
| æŒä¹…åŒ–å­˜å‚¨ | â­â­â­ ä¸­ç­‰ | â­â­â­ å¿« | â­â­â­ é«˜ | äº‘å¹³å° |

---

## ðŸ§© Schema å‡çº§ï¼šelement_list ä¸Žè¶…å¯¼ç±»åž‹æ ‡å‡†åŒ–

å‰ç«¯çš„å…ƒç´ ç»„åˆç­›é€‰ä¸Žå›¾è¡¨ä¾èµ–ä»¥ä¸‹æ•°æ®åº“ç»“æž„ï¼Œè¯·åœ¨éƒ¨ç½²æˆ–æ¢å¤å¤‡ä»½åŽæ‰§è¡Œä¸€æ¬¡å‡çº§è„šæœ¬ï¼š
- `compounds.element_list`ï¼šä¿å­˜å…ƒç´  JSON åˆ—è¡¨ï¼Œæ”¯æŒâ€œä»…åŒ…å«/ç»„åˆ/åŒ…å«æ‰€é€‰å…ƒç´ â€ç­›é€‰
- `papers.superconductor_type`ï¼šä»…å…è®¸ã€Œé“œåŸºã€é“åŸºã€é•åŸºã€é«˜åŽ‹æ°¢åŒ–ç‰©ã€ç¢³åŸºã€æœ‰æœºã€å…¶ä»–è¶…å¯¼ã€ä¸ƒå¤§ç±»

### è¿è¡Œå‡çº§è„šæœ¬

```bash
# å¦‚éƒ¨ç½²åœ¨ Railway/Renderï¼Œè¯·å…ˆè®¾ç½®æ•°æ®åº“è·¯å¾„
export DATABASE_PATH=/app/data/superconductor.db

# æ‰§è¡Œ schema å‡çº§ï¼ˆå¹‚ç­‰ï¼Œå¯é‡å¤è¿è¡Œï¼‰
python -m backend.migrations.schema_202502
```

è„šæœ¬ä¼šè‡ªåŠ¨ï¼š
1. æ£€æŸ¥å¹¶æ–°å¢ž `element_list` åˆ—
2. ä¾æ® `element_symbols` è¡¥å†™ JSON åˆ—è¡¨
3. å°† `conventionalã€carbon_organic` ç­‰æ—§ç±»åž‹æ˜ å°„åˆ°ä¸ƒå¤§ç±»

### å‡çº§åŽå¿«é€Ÿè‡ªæ£€

```bash
sqlite3 $DATABASE_PATH "SELECT element_symbols, element_list FROM compounds LIMIT 5;"
sqlite3 $DATABASE_PATH "SELECT DISTINCT superconductor_type FROM papers;"
```

å¦‚ä»å‡ºçŽ°ç©º `[]` æˆ–æ—§ç±»åž‹å€¼ï¼Œå¯å†æ¬¡è¿è¡Œè„šæœ¬æˆ–æ£€æŸ¥ `DATABASE_PATH` æ˜¯å¦æŒ‡å‘æŒä¹…åŒ–å·ã€‚

---

## ðŸ”„ å®šæœŸå¤‡ä»½å»ºè®®

### è‡ªåŠ¨å¤‡ä»½è„šæœ¬

åˆ›å»º `backup.sh`ï¼š
```bash
#!/bin/bash
DATE=$(date +%Y%m%d_%H%M%S)
BACKUP_DIR="backups"

mkdir -p $BACKUP_DIR

# å¯¼å‡ºJSON
python -m backend.export_data data_export_${DATE}.json

# ç§»åŠ¨åˆ°å¤‡ä»½ç›®å½•
mv data_export_${DATE}.json $BACKUP_DIR/

# åŽ‹ç¼©
gzip $BACKUP_DIR/data_export_${DATE}.json

echo "âœ… å¤‡ä»½å®Œæˆ: $BACKUP_DIR/data_export_${DATE}.json.gz"

# åˆ é™¤30å¤©å‰çš„å¤‡ä»½
find $BACKUP_DIR -name "data_export_*.json.gz" -mtime +30 -delete
```

**è®¾ç½®å®šæ—¶ä»»åŠ¡ï¼ˆæ¯å¤©å‡Œæ™¨2ç‚¹ï¼‰ï¼š**
```bash
crontab -e
```

æ·»åŠ ï¼š
```
0 2 * * * cd /var/www/conventional-sc-dataset && ./backup.sh
```

---

## âš ï¸ é‡è¦æé†’

### éƒ¨ç½²å‰å¿…é¡»åšçš„äº‹ï¼š

1. **æœ¬åœ°æµ‹è¯•å¯¼å‡ºå¯¼å…¥**
   ```bash
   # å¯¼å‡º
   python -m backend.export_data

   # åˆ›å»ºæµ‹è¯•æ•°æ®åº“
   mv data/superconductor.db data/superconductor_original.db
   python -m backend.init_db

   # å¯¼å…¥æµ‹è¯•
   python -m backend.import_data

   # éªŒè¯æ•°æ®å®Œæ•´æ€§
   python -m backend.main
   # è®¿é—® http://localhost:8000 æ£€æŸ¥æ•°æ®
   ```

2. **å¤‡ä»½åŽŸå§‹æ•°æ®åº“**
   ```bash
   cp data/superconductor.db data/superconductor_backup_before_deploy.db
   ```

3. **è®°å½•ç»Ÿè®¡ä¿¡æ¯**
   - æ–‡çŒ®æ•°é‡
   - æˆªå›¾æ•°é‡
   - æ•°æ®åº“æ–‡ä»¶å¤§å°

### æ•°æ®è¿ç§»æ£€æŸ¥æ¸…å•

- [ ] å¯¼å‡ºæ•°æ®æˆåŠŸ
- [ ] JSONæ–‡ä»¶å®Œæ•´ï¼ˆèƒ½æ­£å¸¸æ‰“å¼€ï¼‰
- [ ] ä¸Šä¼ åˆ°æœåŠ¡å™¨æˆåŠŸ
- [ ] å¯¼å…¥æ•°æ®æˆåŠŸ
- [ ] ç½‘é¡µèƒ½æ­£å¸¸è®¿é—®
- [ ] æ–‡çŒ®æ•°é‡æ­£ç¡®
- [ ] æˆªå›¾èƒ½æ­£å¸¸æ˜¾ç¤º
- [ ] æœç´¢åŠŸèƒ½æ­£å¸¸

---

## ðŸ†˜ å¸¸è§é—®é¢˜

### Q1: å¯¼å‡ºçš„JSONæ–‡ä»¶å¾ˆå¤§æ€Žä¹ˆåŠžï¼Ÿ

**A:** åŽ‹ç¼©åŽä¸Šä¼ 
```bash
gzip data/data_export.json
# ä¸Šä¼  data_export.json.gz
# æœåŠ¡å™¨ä¸Šè§£åŽ‹
gunzip data_export.json.gz
```

### Q2: å¯¼å…¥æ—¶æç¤º"æ–‡çŒ®å·²å­˜åœ¨"ï¼Ÿ

**A:** æ­£å¸¸çŽ°è±¡ï¼Œè„šæœ¬ä¼šè‡ªåŠ¨è·³è¿‡é‡å¤æ•°æ®ï¼Œä¸ä¼šè¦†ç›–çŽ°æœ‰æ–‡çŒ®ã€‚

### Q3: Railway/Render éƒ¨ç½²åŽæ•°æ®åº“æ˜¯ç©ºçš„ï¼Ÿ

**A:** å› ä¸ºå®¹å™¨é‡å¯ä¼šæ¸…ç©ºæ•°æ®ã€‚å¿…é¡»é…ç½®æŒä¹…åŒ–å­˜å‚¨ï¼ˆVolume/Diskï¼‰ã€‚

### Q4: å¦‚ä½•åªå¯¼å‡ºç‰¹å®šå…ƒç´ ç»„åˆçš„æ•°æ®ï¼Ÿ

**A:** ä¿®æ”¹ `export_data.py`ï¼Œæ·»åŠ è¿‡æ»¤æ¡ä»¶ï¼š
```python
# ä¾‹å¦‚åªå¯¼å‡º Y-Ba-Cu-O ç³»ç»Ÿ
papers = db.query(models.Paper).join(models.Compound).filter(
    models.Compound.element_symbols == "Ba-Cu-O-Y"
).all()
```

### Q5: å¯¼å…¥å¤±è´¥ï¼Œå¦‚ä½•å›žæ»šï¼Ÿ

**A:** å¦‚æžœå¯¼å…¥å‰æ²¡æœ‰æ¸…ç©ºæ•°æ®ï¼ˆ`--clear`ï¼‰ï¼ŒåŽŸæœ‰æ•°æ®ä¸ä¼šå—å½±å“ã€‚å¦‚æžœä½¿ç”¨äº† `--clear`ï¼Œä»Žå¤‡ä»½æ–‡ä»¶æ¢å¤ï¼š
```bash
cp data/superconductor_backup.db data/superconductor.db
```

---

## ðŸ“ž æŠ€æœ¯æ”¯æŒ

å¦‚æžœé‡åˆ°æ•°æ®è¿ç§»é—®é¢˜ï¼š
1. æ£€æŸ¥å¯¼å‡ºçš„JSONæ–‡ä»¶æ˜¯å¦å®Œæ•´
2. æŸ¥çœ‹å¯¼å…¥æ—¶çš„é”™è¯¯ä¿¡æ¯
3. ç¡®è®¤æœåŠ¡å™¨ä¸Šæ•°æ®åº“è·¯å¾„æ­£ç¡®
4. éªŒè¯æŒä¹…åŒ–å­˜å‚¨é…ç½®

---

**ðŸ’¡ å»ºè®®ï¼š** åœ¨æ­£å¼éƒ¨ç½²å‰ï¼Œå…ˆåœ¨æœ¬åœ°æµ‹è¯•ä¸€éå®Œæ•´çš„å¯¼å‡ºâ†’å¯¼å…¥æµç¨‹ï¼Œç¡®ä¿æ•°æ®ä¸ä¼šä¸¢å¤±ï¼
